generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id   Int    @id @default(autoincrement())
  name String @unique

  testimonies Testimony[]
  persons     Person[]
  factors     Factor[]
  events      Event[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("projects")
}

model Person {
  id          Int         @id @default(autoincrement())
  firstName   String      @map("first_name")
  lastName    String      @map("last_name")
  testimonies Testimony[]

  projectId Int     @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("persons")
}

model Testimony {
  id        Int      @id @default(autoincrement())
  ruj       String?
  status    String
  type      String
  content   String
  facts     String[] @default([])
  dateAdded DateTime @default(now()) @map("date_added")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  personId Int    @map("person_id")
  person   Person @relation(fields: [personId], references: [id], onDelete: Cascade)

  projectId Int     @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  factors Factor[]
  events  Event[]

  @@map("testimonies")
}

model Factor {
  id       Int    @id @default(autoincrement())
  code     String
  verbatim String

  projectId Int     @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  testimonyId Int       @map("testimony_id")
  testimony   Testimony @relation(fields: [testimonyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("factors")
}

model Event {
  id       Int      @id @default(autoincrement())
  content  String
  title    String
  verbatims String[]
  linkedTo String?  @map("linked_to")

  projectId Int     @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  testimonyId Int       @map("testimony_id")
  testimony   Testimony @relation(fields: [testimonyId], references: [id], onDelete: Cascade)

  beginAt    DateTime? @map("begin_at")
  endAt      DateTime? @map("end_at")
  beginAtRaw String?   @map("begin_at_raw")
  endAtRaw   String?   @map("end_at_raw")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("events")
}

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model LoginAttempt {
  id          Int      @id @default(autoincrement())
  ip          String   @unique
  attempts    Int      @default(1)
  windowStart DateTime @map("window_start")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("login_attempts")
}
